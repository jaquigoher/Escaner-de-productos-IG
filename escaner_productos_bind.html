<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Esc치ner de Productos - Importaciones Gonz치lez</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #ffffff;
      margin: 0;
      padding: 0;
    }
    header {
      display: flex;
      align-items: center;
      padding: 10px 20px;
      background-color: white;
    }
    header img {
      height: 180px;
      margin-right: 20px;
    }
    header .company-name {
      font-size: 2.5rem;
      font-weight: bold;
      color: #000;
      white-space: nowrap;
    }
    main {
      text-align: center;
      padding: 40px 20px;
    }
    input {
      font-size: 28px;
      padding: 10px;
      width: 80%;
      max-width: 500px;
      margin-bottom: 30px;
      border-radius: 8px;
      border: 2px solid #555;
    }
    button {
      font-size: 20px;
      padding: 15px 30px;
      margin: 10px;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    .IG { background-color: #f7c600; color: black; }
    .Manix { background-color: #8B0000; }
    .Belie { background-color: #d400d4; }
    .VDC { background-color: #ff6600; }
    .FM { background-color: #00a878; }
    .AMZ_IG { background-color: #007bff; }
    .AMZ_VDC { background-color: #a078ff; }
  </style>
</head>
<body>
  <header>
    <img src="https://http2.mlstatic.com/D_NQ_NP_666948-MLA81666886288_012025-O.webp" alt="Importaciones Gonz치lez" />
    <div class="company-name">Importaciones Gonz치lez S. A. de C. V.</div>
  </header>

  <main>
    <h1>游닍 Escanea el c칩digo y selecciona la cuenta</h1>
    <input type="text" id="codeInput" placeholder="Escanea aqu칤..." autofocus autocomplete="off" />

    <div>
      <button class="IG" data-window="IG">IG</button>
      <button class="Manix" data-window="Manix">Manix</button>
      <button class="Belie" data-window="Belie">Beli칠</button>
      <button class="VDC" data-window="VDC">VDC</button>
      <button class="FM" data-window="FM">FM</button>
      <button class="AMZ_IG">AMZ IG</button>
      <button class="AMZ_VDC">AMZ VDC</button>
    </div>
  </main>

  <img id="imagenProducto" style="display:none; width:100vw; height:100vh; object-fit:contain;" />

  <audio id="success" src="https://cdn.pixabay.com/audio/2022/03/15/audio_7a0fb455d1.mp3"></audio>
  <audio id="error" src="https://cdn.pixabay.com/audio/2022/03/15/audio_07a924d44e.mp3"></audio>

  <script>
    let productos = [];

    // Cargar productos.json
    fetch("productos.json")
      .then(res => res.json())
      .then(data => productos = data);

    const input = document.getElementById("codeInput");
    const successSound = document.getElementById("success");
    const errorSound = document.getElementById("error");
    const img = document.getElementById("imagenProducto");

    // 游녢 AQU칈 DEBES PONER TU API KEY DE BIND
    const BIND_API_KEY = "TU_API_KEY_AQUI";

    function mostrarImagenDesdeBind(codigoML) {
      const producto = productos.find(p => p.codigo_ml === codigoML);

      if (!producto) {
        alert("C칩digo ML no encontrado en la base de datos.");
        img.style.display = "none";
        errorSound.play();
        input.value = "";
        input.focus();
        return;
      }

      const sku = producto.sku;

      fetch(`http://api.bind.com.mx/api/Products/${sku}/image`, {
        method: "GET",
        headers: {
          "Authorization": `Bearer ${BIND_API_KEY}`
        }
      })
      .then(response => {
        if (!response.ok) throw new Error("No se encontr칩 imagen en Bind");
        return response.blob();
      })
      .then(blob => {
        const url = URL.createObjectURL(blob);
        img.src = url;
        img.style.display = "block";
        successSound.play();
      })
      .catch(err => {
        alert("Error al obtener imagen desde Bind: " + err.message);
        img.style.display = "none";
        errorSound.play();
      })
      .finally(() => {
        input.value = "";
        input.focus();
      });
    }

    function abrirML(windowName) {
      const code = input.value.trim().toUpperCase();
      if (/^[A-Z]{4}[0-9]{5}$/.test(code)) {
        const url = "https://www.mercadolibre.com.mx/publicaciones/listado/space_management?search=" + code;
        window.open(url, windowName);
        successSound.play();
      } else {
        alert("C칩digo inv치lido. Debe tener 4 letras seguidas de 5 n칰meros (ejemplo: ABCD12345).");
        errorSound.play();
      }
      input.value = "";
      input.focus();
    }

    function abrirAmazon() {
      const code = input.value.trim().toUpperCase();
      if (/^B0[A-Z0-9]{8}$/.test(code)) {
        const url = `https://www.amazon.com.mx/dp/${code}`;
        window.open(url, "_blank");
        successSound.play();
      } else {
        alert("C칩digo inv치lido. El ASIN debe comenzar con 'B0' y tener 10 caracteres.");
        errorSound.play();
      }
      input.value = "";
      input.focus();
    }

    document.querySelectorAll('button').forEach(btn => {
      btn.addEventListener('click', () => {
        if (btn.classList.contains('AMZ_IG') || btn.classList.contains('AMZ_VDC')) {
          abrirAmazon();
        } else {
          abrirML(btn.getAttribute('data-window'));
        }
      });
    });

    // Tambi칠n mostrar imagen autom치ticamente si presiona Enter
    input.addEventListener("keydown", e => {
      if (e.key === "Enter") {
        const codigo = input.value.trim().toUpperCase();
        mostrarImagenDesdeBind(codigo);
      }
    });

    window.onload = () => input.focus();
    document.body.addEventListener("click", () => input.focus());
  </script>
</body>
</html>
